<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LUCKY WHEEL - A1</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Be Vietnam Pro', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .wheel-display {
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.7), 0 0 20px rgba(255, 255, 255, 0.5);
            font-weight: 900;
        }

        .btn-spin {
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn-spin:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        .btn-spin:active {
            transform: translateY(1px);
        }

        .btn-spin:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: translateY(0);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        /* Confetti animation */
        .confetti-piece {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #f00;
            opacity: 0;
            animation: fall 5s linear forwards;
        }

        @keyframes fall {
            0% {
                opacity: 1;
                transform: translateY(-10vh) rotate(0deg);
            }
            100% {
                opacity: 1;
                transform: translateY(110vh) rotate(720deg);
            }
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <div id="app" class="text-center p-6 md:p-10 bg-white/20 backdrop-blur-xl rounded-2xl shadow-2xl max-w-2xl w-full border border-white/30">
        <!-- Main content -->
        <h1 class="text-4xl md:text-5xl font-black text-white mb-3" style="text-shadow: 0 2px 4px rgba(0,0,0,0.2);">LUCKY WHEEL - A1</h1>
        <p class="text-white/80 mb-8">Giữ nút để chọn lực quay!</p>

        <!-- The "Slot Machine" Display -->
        <div id="wheel-container" class="relative w-full mx-auto h-28 md:h-36 bg-gray-900/50 rounded-lg overflow-hidden flex items-center justify-center border-2 border-white/50 shadow-inner px-2">
             <div class="absolute top-0 left-0 w-full h-1/2 bg-gradient-to-b from-black/50 to-transparent z-10"></div>
             <div class="absolute bottom-0 left-0 w-full h-1/2 bg-gradient-to-t from-black/50 to-transparent z-10"></div>
            <div id="name-display" class="relative wheel-display text-4xl sm:text-5xl md:text-6xl text-white transition-transform duration-100 ease-linear whitespace-nowrap z-20">
                <!-- Tên học sinh sẽ hiển thị ở đây -->
            </div>
            <!-- Power Overlays -->
            <div id="power-bar-positive" class="absolute left-1/2 top-0 h-full rounded-r-sm opacity-70" style="width: 0%; background: linear-gradient(90deg, #A7F3D0, #34D399);"></div>
            <div id="power-bar-negative" class="absolute right-1/2 top-0 h-full rounded-l-sm opacity-70" style="width: 0%; background: linear-gradient(270deg, #FCA5A5, #EF4444);"></div>
        </div>
        
        <!-- Spin Button -->
        <button id="spin-button" class="btn-spin mt-8 w-full md:w-auto text-2xl font-bold bg-white text-indigo-600 px-12 py-4 rounded-full shadow-lg hover:bg-yellow-300">
            Bắt đầu quay!
        </button>

        <!-- Confetti Container -->
        <div id="confetti-container" class="absolute top-0 left-0 w-full h-full pointer-events-none overflow-hidden"></div>

        <!-- Modal for Winner -->
        <div id="winner-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 hidden z-50">
            <div class="bg-white p-6 sm:p-8 rounded-lg text-center shadow-xl transform transition-all scale-95 opacity-0 w-11/12 max-w-lg" id="modal-content">
                <h2 class="text-3xl font-bold text-yellow-500 mb-2">CONGRATULATIONS!</h2>
                <p id="winner-name" class="text-4xl sm:text-5xl font-black text-gray-800 my-6 break-words"></p>
                <button id="close-modal" class="bg-indigo-600 text-white font-bold px-8 py-3 rounded-full hover:bg-indigo-700 transition-colors">Tuyệt vời!</button>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const nameDisplay = document.getElementById('name-display');
        const wheelContainer = document.getElementById('wheel-container');
        const spinButton = document.getElementById('spin-button');
        const winnerModal = document.getElementById('winner-modal');
        const modalContent = document.getElementById('modal-content');
        const winnerName = document.getElementById('winner-name');
        const closeModal = document.getElementById('close-modal');
        const confettiContainer = document.getElementById('confetti-container');
        const powerBarPositive = document.getElementById('power-bar-positive');
        const powerBarNegative = document.getElementById('power-bar-negative');

        const students = ["NGUYỄN HOÀI ANH", "TRẦN THỊ NGỌC ÁNH", "VÕ THỊ KIM ÂN", "NGUYỄN NGỌC MINH CHÂU", "NGUYỄN NGỌC MỸ CHI", "NGUYỄN NGỌC THÀNH CÔNG", "NGUYỄN THỊ KIỀU DIỄM", "VÕ LÊ KIỀU DUYÊN", "NGUYỄN ĐÌNH ĐẠT", "PHẠM THỊ YẾN HẠ", "NGUYỄN LÊ HIẾU", "PHAN THỊ THANH HOA", "HOÀNG MẠNH HUY", "PHAN CẢNH ANH KHÔI", "NGUYỄN TRUNG KIÊN", "NGUYỄN HOÀNG ĐÌNH LUÂN", "ĐẬU THỊ THANH MAI", "HUỲNH THỊ NY NA", "DƯƠNG THỊ KIM NGÂN", "TRẦN YẾN NGÂN", "NGUYỄN HỒNG THẢO NGUYÊN", "PHÙNG BÁ VĨNH NGUYÊN", "ĐOÀN THỊ NGỌC NHI", "NGUYỄN THỊ THẢO NHI", "PHAN HOÀNG GIA NHƯ", "PHẠM THỊ HỒNG NHUNG", "HUỲNH PHÚC KHANG NINH", "NGUYỄN VĂN PHƯỚC", "ĐOÀN ANH QUANG", "NGUYỄN THỊ NHƯ QUYÊN", "ĐINH THỊ DIỄM QUỲNH", "LƯƠNG NGỌC THIÊN THANH", "NGUYỄN ĐÌNH THÀNH", "MAI QUANG THIÊN", "NGUYỄN NGỌC BẢO THY", "TRẦN QUỲNH THY", "NGUYỄN DƯƠNG BẢO TRÂN", "NGUYỄN NGỌC HUYỀN TRANG", "ĐỖ VĂN TRƯỜNG", "ĐẶNG LÊ MINH TUẤN", "NGUYỄN ANH TUẤN", "NGUYỄN MẠNH TUẤN", "VƯƠNG THANH TÙNG", "LÊ TRƯỜNG THU UYÊN", "HỒ THỊ TƯỜNG VI", "VŨ DUY VINH", "HOÀNG LÊ VY", "NGUYỄN TRÚC UYÊN VY"
];
        
        // Game State
        let isSpinning = false;
        let isCharging = false;
        let powerLevel = 0;
        let chargeInterval;
        let spinTimeout;
        let currentIndex = Math.floor(Math.random() * students.length);

        // --- FONT SIZE ADJUSTMENT ---
        const adjustFontSize = (element, container) => {
            element.style.fontSize = ''; // Reset to CSS default
            const baseFontSize = parseFloat(getComputedStyle(element).fontSize);
            let scale = 1;

            if (element.scrollWidth > container.clientWidth) {
                scale = container.clientWidth / element.scrollWidth;
            }
            
            element.style.fontSize = `${Math.max(12, baseFontSize * scale)}px`;
        };

        // --- INITIALIZE ---
        const initialize = () => {
            nameDisplay.textContent = students[currentIndex];
            adjustFontSize(nameDisplay, wheelContainer);
        };
        initialize();
        
        window.addEventListener('resize', () => {
            adjustFontSize(nameDisplay, wheelContainer);
            if (!winnerModal.classList.contains('hidden')) {
                adjustFontSize(winnerName, modalContent);
            }
        });


        // --- PRESS AND HOLD LOGIC ---
        const handlePress = () => {
            if (isSpinning || isCharging) return;
            isCharging = true;
            spinButton.textContent = "Thả ra để quay!";
            startCharge();
        };

        const handleRelease = () => {
            if (!isCharging) return;
            isCharging = false;
            clearInterval(chargeInterval);
            // Hide power bars on release
            powerBarPositive.style.width = '0%';
            powerBarNegative.style.width = '0%';
            startSpin(powerLevel);
        };

        const startCharge = () => {
            const maxPower = 150;
            let angle = 0;

            chargeInterval = setInterval(() => {
                powerLevel = maxPower * Math.sin(angle);
                const barPercentage = (Math.abs(powerLevel) / maxPower) * 50; 

                if (powerLevel >= 0) {
                    powerBarPositive.style.width = `${barPercentage}%`;
                    powerBarNegative.style.width = '0%';
                } else {
                    powerBarNegative.style.width = `${barPercentage}%`;
                    powerBarPositive.style.width = '0%';
                }
                
                angle += 0.05; 
            }, 10);
        };

        const startSpin = (power) => {
            isSpinning = true;
            spinButton.disabled = true;
            spinButton.textContent = 'Đang quay...';
            nameDisplay.classList.remove('text-green-400');
            
            const stepsToAdvance = Math.round(power);
            const direction = Math.sign(stepsToAdvance); 
            const totalSteps = Math.abs(stepsToAdvance);
            
            if (totalSteps === 0) {
                selectWinner();
                return;
            }

            let currentStep = 0;

            const spinAnimation = () => {
                if (currentStep >= totalSteps) {
                    selectWinner();
                    return;
                }
                
                currentStep++;
                currentIndex = (currentIndex + direction + students.length) % students.length;
                nameDisplay.textContent = students[currentIndex];
                adjustFontSize(nameDisplay, wheelContainer); // Adjust on each spin

                const progress = currentStep / totalSteps;
                const delay = 50 + Math.pow(progress, 4) * 450;

                spinTimeout = setTimeout(spinAnimation, delay);
            };
            spinAnimation();
        };

        const selectWinner = () => {
            const winner = students[currentIndex];
            nameDisplay.textContent = winner;
            adjustFontSize(nameDisplay, wheelContainer); // Final adjust
            nameDisplay.classList.add('text-green-400');
            showWinnerModal(winner);
        };
        
        const showWinnerModal = (name) => {
            winnerName.textContent = name;
            winnerModal.classList.remove('hidden');
            adjustFontSize(winnerName, modalContent); // Adjust on show

            setTimeout(() => {
                modalContent.classList.remove('scale-95', 'opacity-0');
                modalContent.classList.add('scale-100', 'opacity-100');
            }, 50);

            launchConfetti();

            setTimeout(() => {
                isSpinning = false;
                spinButton.disabled = false;
                spinButton.textContent = 'Bắt đầu quay!';
            }, 1000);
        };

        const hideWinnerModal = () => {
            modalContent.classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                winnerModal.classList.add('hidden');
                confettiContainer.innerHTML = '';
            }, 300);
        };

        const launchConfetti = () => {
            const colors = ['#f44336', '#e91e63', '#9c27b0', '#673ab7', '#3f51b5', '#2196f3', '#03a9f4', '#00bcd4', '#009688', '#4caf50', '#8bc34a', '#cddc39', '#ffeb3b', '#ffc107', '#ff9800', '#ff5722'];
            const confettiCount = 150;
            
            for (let i = 0; i < confettiCount; i++) {
                const confetti = document.createElement('div');
                confetti.classList.add('confetti-piece');
                confetti.style.left = `${Math.random() * 100}vw`;
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDelay = `${Math.random() * 0.5}s`;
                confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                confetti.style.height = `${Math.random() * 10 + 5}px`;
                confetti.style.width = `${Math.random() * 5 + 5}px`;
                confettiContainer.appendChild(confetti);
            }
        };

        // --- EVENT LISTENERS ---
        spinButton.addEventListener('mousedown', handlePress);
        spinButton.addEventListener('mouseup', handleRelease);
        spinButton.addEventListener('mouseleave', handleRelease);
        spinButton.addEventListener('touchstart', (e) => { e.preventDefault(); handlePress(); });
        spinButton.addEventListener('touchend', handleRelease);

        closeModal.addEventListener('click', hideWinnerModal);
        winnerModal.addEventListener('click', (e) => {
             if (e.target === winnerModal) hideWinnerModal();
        });

    </script>
</body>
</html>

